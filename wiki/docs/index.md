### Определение 
**Микросервис-шаблонизатор для файлов *.docx (MS Office Word), высокопроизводительный, легкий и готовый к использованию**.  

[Шаблонизатор] позволяет заменять переменные шаблона переданным контентом, дополнять существующие параграфы и переопределять стили заменяемых фрагментов.

Юнит стандартизирован до спецификации [OpenAPI v3](https://spec.openapis.org/oas/v3.0.3) и представляет собой типичный [RESTfull API].<br>[Swagger UI] является неотъемлемой частью основного кода.

Шаблоны и готовые файлы принадлежащие одному издателю токенов доступны только для определённых запросов. Для уникальности готовых файлов, к именам добавляется хеш контента.

### Алгоритм работы

Готовим шаблон, места замены маркируем [Jinja2] синтаксисом. Загружаем, готовим контент. Отправляем запрос, получаем ссылку на готовый документ. 

Авторизация запросов основана на [JWT Standart], при этом используется аудиенция токена.  

Предлагается следующая схема: Администратор данного сервиса размещает публичный ключ сервиса клиента в папке `authorized_keys`. После этого сервис готов принимать запросы.

!!! attention "Поддерживается только [JWT] аутентификация по ассиметричным алгоритмам ("ES256", "ES512", "PS256", "PS512", "EdDSA")."
!!! attention "Каждый ключ должен находится в отдельном файле.<br> Имя ключа должно соотвествовать имени издателя определенном в поле токена `iss`.<br> Точки и тире нужно заменить на нижнее подчеркивание."

Клиент запрашивает авторизационный токен, в котором должны присутствовать нужные аудиенции. Получив его отправляет запросы к сервису, последний верифицирует полученный токен (в данном случае на публичном ключе сервиса выпустившего токен, не обращась к последнему).  

Таким образом сервису не требуется взаимодействовать с `auth` юнитом, не требуется и хранить реестр пользователей у себя.  

!!! info "Реализуется основной принцип [RESTfull API]. Любой и каждый запрос самодостаточен."  

### Развертывание

```shell
# скопировать и установить нужные значения
cp template.env .env
# создать нужные папки
mkdir templates downloads authorized_keys 
# загрузить в папку authorized_keys публичный ключ/и сервисов клиентов
# добавить нужные шаблоны в папку templates
# запустить сервис
docker compose up 
```

Ниже указан тестовый бессрочный токен с максимальной аудиенцией.   
Публичный ключ издателя сервису уже добавлен.  
Можно выполнять запросы с данным токеном. 
```shell
eyJhbGciOiJFUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJ0ZXN0LWF1dGguc2l0ZS5jb20iLCJ0eXBlIjoiYWNjZXNzIiwiZXhwIjoxOTk0ODE5MDgxLCJhdWQiOlsiZG9jeC1zdXBlciJdfQ.nDpRlfCJlZK6MwsQERyZQfsztqNC8_MKuYApyS2IWwBEjkw3lQ7ne6OyG6qvHQS7dB2JRy_uJuJDDjswQYVWuA
```

{% 
include 'links.md'
rewrite-relative-urls=false
%}
